# 占い自動鑑定システム開発 - WBS（作業分解構成）

## 1. プロジェクト準備フェーズ（5日間）

### 1.1 開発環境構築（2日）
- 1.1.1 開発PC環境セットアップ（0.5日）
  - Node.js、npm/yarn インストール
  - VSCode + 拡張機能セットアップ
  - Git設定
- 1.1.2 プロジェクト初期設定（1日）
  - Next.js 14プロジェクト作成
  - TypeScript設定
  - ESLint/Prettier設定
  - Tailwind CSS設定
- 1.1.3 開発ツール設定（0.5日）
  - GitHub リポジトリ作成
  - Vercelアカウント作成・連携
  - 環境変数設定

### 1.2 外部サービス準備（2日）
- 1.2.1 Supabase設定（0.5日）
  - アカウント作成
  - プロジェクト作成
  - 接続情報取得
- 1.2.2 Stripe設定（0.5日）
  - アカウント作成
  - API キー取得
  - Webhook設定
- 1.2.3 Anthropic API設定（0.5日）
  - APIキー取得
  - 利用制限設定
- 1.2.4 その他サービス設定（0.5日）
  - Resend（メール送信）
  - Uploadthing（ファイルアップロード）

### 1.3 設計ドキュメント作成（1日）
- 1.3.1 データベース詳細設計（0.5日）
- 1.3.2 API仕様書作成（0.5日）

## 2. 基盤開発フェーズ（10日間）

### 2.1 データベース構築（2日）
- 2.1.1 Prismaセットアップ（0.5日）
- 2.1.2 スキーマ定義（1日）
  - users テーブル
  - admins テーブル
  - fortune_requests テーブル
  - ai_results テーブル
  - credit_transactions テーブル
- 2.1.3 マイグレーション実行（0.5日）

### 2.2 認証機能実装（3日）
- 2.2.1 NextAuth.js設定（1日）
  - プロバイダー設定
  - セッション管理設定
- 2.2.2 ユーザー認証実装（1日）
  - ログイン画面UI
  - 登録画面UI
  - パスワードリセット機能
- 2.2.3 管理者認証実装（1日）
  - 管理者ログイン画面
  - 権限管理ミドルウェア

### 2.3 基本UI構築（3日）
- 2.3.1 レイアウトコンポーネント（1日）
  - ヘッダー
  - サイドバー
  - フッター
- 2.3.2 共通コンポーネント（1日）
  - ボタン
  - フォーム要素
  - モーダル
  - 通知
- 2.3.3 レスポンシブ対応（1日）

### 2.4 APIルート基盤（2日）
- 2.4.1 tRPC設定（1日）
  - ルーター設定
  - コンテキスト設定
- 2.4.2 エラーハンドリング（1日）
  - グローバルエラーハンドラー
  - バリデーション設定

## 3. コア機能開発フェーズ（15日間）

### 3.1 ユーザーダッシュボード（3日）
- 3.1.1 ダッシュボード画面（1日）
  - レイアウト実装
  - 占いメニュー表示
- 3.1.2 鑑定履歴機能（1日）
  - 履歴一覧表示
  - ページネーション
- 3.1.3 クレジット表示（1日）
  - 残高表示
  - 使用履歴

### 3.2 占い申込機能（4日）
- 3.2.1 占い選択画面（1日）
  - 占い種類一覧
  - 詳細説明表示
- 3.2.2 入力フォーム実装（2日）
  - 共通入力項目
  - 占い別入力項目
  - バリデーション
- 3.2.3 確認・完了画面（1日）

### 3.3 Claude API連携（4日）
- 3.3.1 API通信実装（1日）
  - Anthropic SDK設定
  - エラーハンドリング
- 3.3.2 プロンプトテンプレート（1日）
  - 占い種別テンプレート作成
  - 変数置換処理
- 3.3.3 鑑定文生成処理（1日）
  - 非同期処理実装
  - キューイング機能
- 3.3.4 レート制限対策（1日）

### 3.4 PDF生成機能（4日）
- 3.4.1 PDFテンプレート作成（2日）
  - デザイン実装
  - 日本語フォント設定
- 3.4.2 PDF生成処理（1日）
  - React PDF実装
  - エラーハンドリング
- 3.4.3 PDFプレビュー・ダウンロード（1日）

## 4. 課金機能開発フェーズ（8日間）

### 4.1 クレジット管理（3日）
- 4.1.1 クレジット付与機能（1日）
  - 初回登録ボーナス
  - 手動付与機能
- 4.1.2 クレジット消費処理（1日）
- 4.1.3 残高確認・履歴表示（1日）

### 4.2 Stripe決済実装（5日）
- 4.2.1 Stripe Checkout実装（2日）
  - 商品設定
  - 決済フロー実装
- 4.2.2 Webhook処理（1日）
  - 決済完了処理
  - エラー処理
- 4.2.3 購入画面UI（1日）
  - クレジットパック選択
  - 価格表示
- 4.2.4 領収書機能（1日）

## 5. 管理機能開発フェーズ（10日間）

### 5.1 管理者ダッシュボード（2日）
- 5.1.1 管理画面レイアウト（1日）
- 5.1.2 統計情報表示（1日）
  - ユーザー数
  - 売上情報
  - 鑑定件数

### 5.2 鑑定結果管理（4日）
- 5.2.1 AI生成結果一覧（1日）
  - ステータス別表示
  - 検索・フィルター
- 5.2.2 編集画面実装（2日）
  - テキストエディタ
  - 保存・承認機能
- 5.2.3 承認フロー（1日）

### 5.3 ユーザー管理（2日）
- 5.3.1 ユーザー一覧・検索（1日）
- 5.3.2 ユーザー詳細・編集（1日）
  - クレジット手動付与
  - アカウント停止

### 5.4 売上レポート（2日）
- 5.4.1 日次・月次集計（1日）
- 5.4.2 グラフ表示（1日）

## 6. 占い種類拡張フェーズ（5日間）

### 6.1 タロット占い（1.5日）
- 6.1.1 入力フォーム実装（0.5日）
- 6.1.2 プロンプトテンプレート（0.5日）
- 6.1.3 結果表示調整（0.5日）

### 6.2 西洋占星術（1.5日）
- 6.2.1 入力フォーム実装（0.5日）
- 6.2.2 プロンプトテンプレート（0.5日）
- 6.2.3 結果表示調整（0.5日）

### 6.3 四柱推命（2日）
- 6.3.1 入力フォーム実装（0.5日）
- 6.3.2 プロンプトテンプレート（1日）
- 6.3.3 結果表示調整（0.5日）

## 7. テスト・改善フェーズ（7日間）

### 7.1 単体テスト（2日）
- 7.1.1 コンポーネントテスト（1日）
- 7.1.2 APIテスト（1日）

### 7.2 統合テスト（2日）
- 7.2.1 E2Eテスト実装（1日）
- 7.2.2 決済フローテスト（1日）

### 7.3 パフォーマンス改善（2日）
- 7.3.1 ページ速度最適化（1日）
- 7.3.2 データベースクエリ最適化（1日）

### 7.4 セキュリティ対策（1日）
- 7.4.1 脆弱性診断
- 7.4.2 セキュリティ修正

## 8. リリース準備フェーズ（3日間）

### 8.1 本番環境構築（1日）
- 8.1.1 環境変数設定
- 8.1.2 ドメイン設定

### 8.2 ドキュメント整備（1日）
- 8.2.1 利用規約作成
- 8.2.2 プライバシーポリシー作成
- 8.2.3 特定商取引法表記

### 8.3 リリース作業（1日）
- 8.3.1 本番デプロイ
- 8.3.2 動作確認
- 8.3.3 モニタリング設定

## 総工数: 53日（約11週間）

### リソース配分
- 開発者: 1名（AIペアプログラミング活用）
- 1日あたりの作業時間: 8時間
- バッファ: 各フェーズに10%程度含む